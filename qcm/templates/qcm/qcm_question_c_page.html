{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block title %}{{ page.title }} - QCM{% endblock %}

{% block content %}
<section class="max-w-3xl mx-auto">
  <h1 class="text-2xl font-bold text-blue-800 mb-4">{{ page.title }}</h1>

  <div class="qcm-debug">
    Layout: {{ page.layout }} |
    Image: {% if page.image_id %}Oui (id {{ page.image_id }}){% else %}Non{% endif %} |
    Video: {% if page.video_url %}Oui{% else %}Non{% endif %}
  </div>

  {% if page.layout == "text_media" and page.image_id %}
    <!-- 67% texte / 33% m√©dia -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
      <!-- Texte (67%) -->
      <div class="lg:col-span-2">
        <div class="prose max-w-none">
          {{ page.statement|richtext }}
        </div>
      </div>
      <!-- M√©dia (33%) -->
      <div class="lg:col-span-1">
        <div class="qcm-media-wrap">
          {% image page.image original class="qcm-image rounded shadow" alt=page.image.title %}
        </div>
        {% if page.video_url %}
          <div class="mt-4">
            <a href="{{ page.video_url }}" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm">
              üìπ Voir la vid√©o
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  {% else %}
    <!-- 100% texte (ou fallback) -->
    <div class="prose max-w-none mb-6">
      {{ page.statement|richtext }}
    </div>

    {% if page.image_id %}
      <div class="mb-6 qcm-media-wrap">
        {% image page.image original class="qcm-image rounded shadow" alt=page.image.title %}
      </div>
    {% endif %}

    {% if page.video_url %}
      <div class="mb-6">
        <a href="{{ page.video_url }}" target="_blank" class="text-blue-600 hover:text-blue-800">
          üìπ Voir la vid√©o
        </a>
      </div>
    {% endif %}
  {% endif %}

  {% if page.layout == "text_media" and not page.image_id %}
    <div class="qcm-fallback p-3 rounded bg-yellow-50 border border-yellow-200 text-sm">
      ‚ö†Ô∏è Layout "67% texte / 33% m√©dia" s√©lectionn√© mais aucune image n'est d√©finie.
    </div>
  {% endif %}

  <div class="mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="p-4 bg-green-50 rounded-lg border border-green-200">
        <h3 class="font-semibold text-green-800 mb-2">Bonnes r√©ponses :</h3>
        <ul class="list-disc list-inside space-y-1 text-sm">
          {% for answer in page.get_correct_answers_list %}
            <li class="text-green-700">{{ answer }}</li>
          {% empty %}
            <li class="text-green-700">Aucune bonne r√©ponse d√©finie</li>
          {% endfor %}
        </ul>
      </div>

      <div class="p-4 bg-red-50 rounded-lg border border-red-200">
        <h3 class="font-semibold text-red-800 mb-2">Mauvaises r√©ponses :</h3>
        <ul class="list-disc list-inside space-y-1 text-sm">
          {% for answer in page.get_incorrect_answers_list %}
            <li class="text-red-700">{{ answer }}</li>
          {% empty %}
            <li class="text-red-700">Aucune mauvaise r√©ponse d√©finie</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  {% if page.explanation %}
    <div class="p-4 bg-blue-50 rounded-lg border border-blue-200 mb-6">
      <h3 class="font-semibold text-blue-800 mb-2">Explication :</h3>
      <div class="prose max-w-none text-sm">
        {{ page.explanation|richtext }}
      </div>
    </div>
  {% endif %}
</section>

<style>
/* Emp√™che l'image de d√©border et g√®re SVG/original proprement */
.qcm-media-wrap {
  width: 100%;
  max-width: 400px;   /* adapte si tu veux */
}
.qcm-media-wrap img, .qcm-media-wrap picture, .qcm-media-wrap svg {
  display: block;
  max-width: 100%;
  height: auto;
}

/* Correction des listes */
.prose ul{list-style-type:disc!important;padding-left:1.5rem!important;margin:1rem 0!important}
.prose ol{list-style-type:decimal!important;padding-left:1.5rem!important;margin:1rem 0!important}
.prose li{margin:.5rem 0!important}
.list-disc{list-style-type:disc!important}
.list-inside{list-style-position:inside!important}
</style>
{% endblock %}
