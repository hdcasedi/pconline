{% extends "base.html" %}
{% load wagtailcore_tags %}

{% block title %}{{ page.title }} - Physique Chimie Online{% endblock %}

{% block content %}
<section class="max-w-5xl mx-auto px-4">
  <!-- Titre / Chapitre -->
  <header class="mb-6">
    <h1 class="text-3xl font-bold text-blue-800">
      {{ page.chapitre.numero }} — {{ page.chapitre.titre }}
    </h1>
    <p class="text-sm text-slate-500 mt-1">
      Niveau : {{ page.chapitre.theme.niveau.nom }} • Thème : {{ page.chapitre.theme.nom }}
    </p>
  </header>

  <!-- Onglets -->
  <div class="border-b border-slate-200 mb-4">
    <nav class="flex gap-2" role="tablist" aria-label="Cours / Flashcards">
      <button class="tab-btn px-4 py-2 rounded-t bg-white border-x border-t border-slate-200 -mb-px font-medium"
              data-target="tab-cours">Cours</button>
      <button class="tab-btn px-4 py-2 rounded-t bg-slate-50 hover:bg-white border-x border-t border-transparent hover:border-slate-200 -mb-px font-medium"
              data-target="tab-flashcards">Flashcards</button>
    </nav>
  </div>

  <!-- Panneaux -->
  <div>
    <!-- Onglet Cours -->
    <div id="tab-cours" role="tabpanel">
      <!-- Bouton flottant pour afficher/masquer exemples et remarques -->
      <div class="flex justify-end mb-4">
        <button id="toggleExamplesBtn" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors shadow-lg">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          <span id="toggleText">Afficher exemples</span>
        </button>
      </div>
      
      <div class="space-y-6">
        {% for block in page.contenu %}
          {% include_block block %}
        {% empty %}
          <div class="bg-yellow-50 border border-yellow-200 text-yellow-800 rounded p-4">
            Aucun contenu pour l'instant.
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Onglet Flashcards -->
    <div id="tab-flashcards" role="tabpanel" class="hidden">
      {% include "cours/partials/flashcard_viewer.html" %}
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<style>
/* Animation pour l'affichage des exemples */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

<script>
(function(){
  // Tabs
  const btns = document.querySelectorAll('.tab-btn');
  const panels = { };
  document.querySelectorAll('[role="tabpanel"]').forEach(p => panels[p.id] = p);

  function activate(targetId){
    // boutons
    btns.forEach(b => {
      const isActive = b.dataset.target === targetId;
      b.classList.toggle('bg-white', isActive);
      b.classList.toggle('border-slate-200', isActive);
      b.classList.toggle('bg-slate-50', !isActive);
    });
    // panneaux
    Object.values(panels).forEach(p => p.classList.add('hidden'));
    panels[targetId].classList.remove('hidden');
  }

  btns.forEach(b => b.addEventListener('click', () => activate(b.dataset.target)));
  activate('tab-cours'); // par défaut

  // Gestion de l'affichage/masquage des exemples et remarques
  const toggleBtn = document.getElementById('toggleExamplesBtn');
  const toggleText = document.getElementById('toggleText');
  const toggleableContent = document.querySelectorAll('.toggleable-content');
  
  // État par défaut : masqué
  let isVisible = false;
  
  // Fonction pour basculer l'affichage
  function toggleContent() {
    isVisible = !isVisible;
    
    toggleableContent.forEach(function(element) {
      if (isVisible) {
        element.style.display = 'block';
        element.style.animation = 'fadeIn 0.3s ease-in';
      } else {
        element.style.display = 'none';
      }
    });
    
    // Mise à jour du texte du bouton
    toggleText.textContent = isVisible ? 'Masquer exemples' : 'Afficher exemples';
    
    // Mise à jour de l'icône
    const icon = toggleBtn.querySelector('svg');
    if (isVisible) {
      icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"/>';
    } else {
      icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>';
    }
    
    // Recharger MathJax si nécessaire
    if (window.MathJax && MathJax.typesetPromise) {
      MathJax.typesetPromise();
    }
  }
  
  // Écouteur d'événement pour le bouton
  if (toggleBtn) {
    toggleBtn.addEventListener('click', toggleContent);
  }




})();
</script>
{% endblock %}